const PomoTimerInstance=new PomoTimer,docTitle=document.title;async function loadTodos(){if(null===getCookie("username")||null===getCookie("secureID"))return;const e=new FormData,t=document.querySelector("#todo-list-loading-icon");t.classList.remove("hide"),e.append("requestType","getTodos"),e.append("username",getCookie("username")),e.append("secureID",getCookie("secureID")),await fetch("assets/php/database.php",{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{e&&(document.querySelector("#todo-list").querySelectorAll("*").forEach((e=>e.remove())),e.success&&e.todos&&e.todos.forEach((e=>{const t=document.createElement("div");t.classList.add("todo-item");const o=document.createElement("label");o.classList.add("check-box-container");const s=document.createElement("input");s.type="checkbox",o.appendChild(s);const r=document.createElement("span");r.classList.add("checkmark"),o.appendChild(r),t.appendChild(o),o.addEventListener("click",(async()=>{const t=new FormData;t.append("requestType","deleteTodo"),t.append("username",getCookie("username")),t.append("secureID",getCookie("secureID")),t.append("taskID",e.taskID),await fetch("assets/php/database.php",{method:"POST",body:t}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{e&&e.success&&loadTodos()})).catch((e=>{}))})),t.appendChild(o);const a=document.createElement("div");a.classList.add("todo-item-container"),a.setAttribute("data-task-id",e.taskID),t.appendChild(a);const c=document.createElement("div");c.classList.add("todo-text"),c.textContent=e.taskContent,a.appendChild(c),a.addEventListener("click",(()=>{document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"todo-item-popup",callback:()=>{document.querySelector("#task-input").value=element.querySelector(".todo-text").textContent.trim(),document.querySelector("#todo-item-popup").setAttribute("data-task-id-storage",element.getAttribute("data-task-id")),document.querySelector("#todo-item-save").classList.add("hide")}}}))})),document.querySelector("#todo-list").appendChild(t)})))})).catch((e=>{})),t.classList.add("hide")}function removeTodos(){document.querySelector("#todo-list").querySelectorAll("*").forEach((e=>e.remove()))}function setPomoCounter(e,t){document.querySelector("#pomodoro-counter").textContent=e>99?"99+":e,setPomoCounterProgress(12.5*t)}function resetPomoCounter(){document.querySelector("#pomodoro-counter").textContent="0",setPomoCounterProgress(0)}window.onblur=function(){PomoTimerInstance.setBlurred(!0)},window.onfocus=function(){PomoTimerInstance.setBlurred(!1),document.title=docTitle},window.ondragstart=function(){return!1},window.ondrop=function(){return!1},window.addEventListener("load",(async()=>{if(setTimerColor("var(--background-color)"),document.querySelector("#timer-circle-progress").classList.add("timer-circle-progress-transition"),document.querySelectorAll("form").forEach((e=>e.reset())),null!==getCookie("username")&&null!==getCookie("secureID")){const e=new FormData;e.append("requestType","getPomoScore"),e.append("username",getCookie("username")),e.append("secureID",getCookie("secureID")),await fetch("assets/php/database.php",{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{e&&(e.success?(setCookie("fullPomoScore",e.fullPomoScore),setCookie("partialPomoScore",e.partialPomoScore),setPomoCounter(e.fullPomoScore,e.partialPomoScore),document.querySelector("#todo-create-button").classList.remove("disabled"),document.querySelector("#account-popup-login-page").classList.add("hide"),document.querySelector("#account-popup-user-page").classList.remove("hide"),document.querySelector("#welcome-user-heading").textContent=`Welcome back, ${getCookie("username")}!`,loadTodos()):(deleteCookie("username"),deleteCookie("secureID"),deleteCookie("fullPomoScore"),deleteCookie("partialPomoScore")))}))}document.querySelector("#leaderboard-modal-opener").addEventListener("click",(()=>{document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"leaderboard-popup",callback:async()=>{const e=new FormData;e.append("requestType","getAllTimeLeaderboard"),await fetch("assets/php/database.php",{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{if(e){const t=document.querySelector("#leaderboard-all-time").querySelector("ul");t.querySelectorAll("*").forEach((e=>e.remove())),e.success&&e.leaderboard&&e.leaderboard.forEach((e=>{const o=document.createElement("li");o.classList.add("leaderboard-entry"),o.textContent=`${e.username} - ${e.fullPomoScore}`,t.appendChild(o)}))}})).catch((e=>{})),e.append("requestType","getWeeklyLeaderboard"),await fetch("assets/php/database.php",{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{if(e){const t=document.querySelector("#leaderboard-weekly").querySelector("ul");t.querySelectorAll("*").forEach((e=>e.remove())),e.success&&e.leaderboard&&e.leaderboard.forEach((e=>{const o=document.createElement("li");o.classList.add("leaderboard-entry"),o.textContent=`${e.username} - ${e.scoreDifference}`,t.appendChild(o)}))}})).catch((e=>{}))}}}))})),document.querySelector("#leaderboard-switch-button").addEventListener("click",(()=>{document.querySelector("#leaderboard-all-time").classList.contains("hide")?(document.querySelector("#leaderboard-all-time").classList.remove("hide"),document.querySelector("#leaderboard-weekly").classList.add("hide")):(document.querySelector("#leaderboard-all-time").classList.add("hide"),document.querySelector("#leaderboard-weekly").classList.remove("hide"))})),document.querySelector("#todo-create-button").addEventListener("click",(()=>{null!==getCookie("username")?document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"create-todo-popup"}})):document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"account-popup"}}))})),document.querySelector("#todo-add-task").addEventListener("click",(async e=>{e.preventDefault();const t=document.querySelector("#create-todo-error");if(t.classList.contains("hide")||t.classList.add("hide"),""===document.querySelector("#todo-input").value.trim())t.classList.remove("hide");else{const e=document.querySelector("#todo-input"),t=e.value.trim(),o=document.querySelector("#create-todo-loading-icon");o.classList.remove("hide");const s=new FormData;s.append("requestType","createTodo"),s.append("username",getCookie("username")),s.append("secureID",getCookie("secureID")),s.append("taskContent",t),await fetch("assets/php/database.php",{method:"POST",body:s}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((t=>{t&&t.success&&(loadTodos(),e.value="",document.dispatchEvent(new CustomEvent("closeCurrentModal")))})).catch((e=>{})),o.classList.add("hide")}})),document.querySelector("#todo-item-delete").addEventListener("click",(async e=>{e.preventDefault();const t=document.querySelector("#todo-item-loading-icon");t.classList.remove("hide");const o=new FormData;o.append("requestType","deleteTodo"),o.append("username",getCookie("username")),o.append("secureID",getCookie("secureID")),o.append("taskID",document.querySelector("#todo-item-popup").getAttribute("data-task-id-storage")),await fetch("assets/php/database.php",{method:"POST",body:o}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{e&&e.success&&loadTodos()})).catch((e=>{})),t.classList.add("hide"),document.dispatchEvent(new CustomEvent("closeCurrentModal"))})),document.querySelector("#todo-item-save").addEventListener("click",(async e=>{e.preventDefault();const t=document.querySelector("#edit-todo-error");if(t.classList.contains("hide")||t.classList.add("hide"),""===document.querySelector("#task-input").value.trim())t.classList.remove("hide");else{const e=document.querySelector("#todo-item-loading-icon");e.classList.remove("hide");const t=new FormData;t.append("requestType","editTodo"),t.append("username",getCookie("username")),t.append("secureID",getCookie("secureID")),t.append("taskID",document.querySelector("#todo-item-popup").getAttribute("data-task-id-storage")),t.append("taskContent",document.querySelector("#task-input").value.trim()),await fetch("assets/php/database.php",{method:"POST",body:t}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((()=>{document.dispatchEvent(new CustomEvent("closeCurrentModal")),loadTodos()})).catch((e=>{})),e.classList.add("hide")}})),document.querySelector("#task-input").addEventListener("keyup",(()=>{"flex"===document.querySelector("#todo-item-popup").style.display&&document.querySelector("#todo-item-save").classList.remove("hide")})),document.querySelector("#go-to-registration").addEventListener("click",(()=>{document.querySelector("#account-popup-registration-page").classList.remove("hide"),document.querySelector("#account-popup-login-page").classList.add("hide"),document.querySelector("#login-input-error").classList.contains("hide")||document.querySelector("#login-input-error").classList.add("hide")})),document.querySelector("#login-form").addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector("#login-input-error");t.classList.contains("hide")||t.classList.add("hide");const o=new FormData(e.target),s=document.querySelector("#account-popup-loading-icon");s.classList.remove("hide"),o.append("requestType","login"),await fetch("assets/php/database.php",{method:"POST",body:o}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((s=>{if(s){if(s.success)null===getCookie("username")&&document.querySelector("#todo-create-button").classList.remove("disabled"),setCookie("username",o.get("username")),setCookie("secureID",s.secureID),setCookie("fullPomoScore",s.fullPomoScore),setCookie("partialPomoScore",s.partialPomoScore),setPomoCounter(s.fullPomoScore,s.partialPomoScore),loadTodos(),resetTimer(),document.dispatchEvent(new CustomEvent("closeCurrentModal")),document.querySelector("#account-popup-login-page").classList.add("hide"),document.querySelector("#account-popup-user-page").classList.remove("hide"),document.querySelector("#welcome-user-heading").textContent=`Welcome back, ${getCookie("username")}!`;else if(1===s.code){t.classList.remove("hide");const e=document.querySelectorAll("#login-form input");e.forEach((e=>{e.classList.add("form-input-shake")})),setTimeout((()=>{e.forEach((e=>{e.classList.remove("form-input-shake")}))}),820)}e.target.reset()}})).catch((e=>{})),s.classList.add("hide")})),document.querySelector("#go-to-login").addEventListener("click",(()=>{document.querySelector("#account-popup-registration-page").classList.add("hide"),document.querySelector("#account-popup-login-page").classList.remove("hide"),document.querySelector("#registration-username-error").classList.contains("hide")||document.querySelector("#registration-username-error").classList.add("hide"),document.querySelector("#registration-password-error").classList.contains("hide")||document.querySelector("#registration-password-error").classList.add("hide")})),document.querySelector("#registration-form").addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector("#registration-username-error");t.classList.contains("hide")||t.classList.add("hide");const o=document.querySelector("#registration-username-space-error");o.classList.contains("hide")||o.classList.add("hide");const s=document.querySelector("#registration-password-error");s.classList.contains("hide")||s.classList.add("hide");const r=document.querySelector("#registration-password-space-error");r.classList.contains("hide")||r.classList.add("hide");const a=document.querySelector("#account-popup-loading-icon");a.classList.remove("hide");const c=new FormData(e.target);if(c.append("requestType","register"),c.get("username").includes(" ")){o.classList.remove("hide");const e=document.querySelector("#registration-form input[type='text']");e.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake")}),820)}else if(c.get("password").includes(" ")){r.classList.remove("hide");const e=document.querySelectorAll("#registration-form input[type='password']");e.forEach((e=>{e.classList.add("form-input-shake")})),setTimeout((()=>{e.forEach((e=>{e.classList.remove("form-input-shake")}))}),820)}else await fetch("assets/php/database.php",{method:"POST",body:c}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((o=>{if(o)if(o.success)null===getCookie("username")&&document.querySelector("#todo-create-button").classList.remove("disabled"),setCookie("username",c.get("username")),setCookie("secureID",o.secureID),setCookie("fullPomoScore",0),setCookie("partialPomoScore",0),loadTodos(),resetTimer(),document.dispatchEvent(new CustomEvent("closeCurrentModal")),document.querySelector("#account-popup-registration-page").classList.add("hide"),document.querySelector("#account-popup-user-page").classList.remove("hide"),document.querySelector("#welcome-user-heading").textContent=`Welcome back, ${getCookie("username")}!`,e.target.reset();else if(1===o.code){t.classList.remove("hide");const e=document.querySelector("#registration-form input[type='text']");e.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake")}),820)}else if(2===o.code){s.classList.remove("hide");const e=document.querySelectorAll("#registration-form input[type='password']");e.forEach((e=>{e.classList.add("form-input-shake")})),setTimeout((()=>{e.forEach((e=>{e.classList.remove("form-input-shake")}))}),820)}})).catch((e=>{}));a.classList.add("hide")})),document.querySelector("#change-password-form").addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector("#user-current-password-error");t.classList.contains("hide")||t.classList.add("hide");const o=document.querySelector("#user-confirm-password-error");o.classList.contains("hide")||o.classList.add("hide");const s=document.querySelector("#user-confirm-password-space-error");s.classList.contains("hide")||s.classList.add("hide");const r=document.querySelector("#user-confirm-password-original-error");r.classList.contains("hide")||r.classList.add("hide");const a=document.querySelector("#account-popup-loading-icon");a.classList.remove("hide");const c=new FormData(e.target);if(c.append("username",getCookie("username")),c.append("secureID",getCookie("secureID")),c.append("requestType","updatePassword"),c.get("newPassword").includes(" ")||c.get("confirmNewPassword").includes(" ")){s.classList.remove("hide");const e=document.querySelector("#changePasswordNew"),t=document.querySelector("#changePasswordConfirm");e.classList.add("form-input-shake"),t.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake"),t.classList.remove("form-input-shake")}),820)}else await fetch("assets/php/database.php",{method:"POST",body:c}).then((e=>{if(e.ok)return e.json();400===e.status||e.status})).then((e=>{if(e)if(e.success)document.dispatchEvent(new CustomEvent("closeCurrentModal"));else if(1===e.code){t.classList.remove("hide");const e=document.querySelector("#changePasswordCurrent");e.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake")}),820)}else if(2===e.code){o.classList.remove("hide");const e=document.querySelector("#changePasswordNew"),t=document.querySelector("#changePasswordConfirm");e.classList.add("form-input-shake"),t.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake"),t.classList.remove("form-input-shake")}),820)}else if(3===e.code){r.classList.remove("hide");const e=document.querySelector("#changePasswordNew"),t=document.querySelector("#changePasswordConfirm");e.classList.add("form-input-shake"),t.classList.add("form-input-shake"),setTimeout((()=>{e.classList.remove("form-input-shake"),t.classList.remove("form-input-shake")}),820)}})).catch((e=>{}));a.classList.add("hide"),e.target.reset()})),document.querySelector("#user-logout-button").addEventListener("click",(e=>{e.preventDefault(),deleteCookie("username"),deleteCookie("secureID"),deleteCookie("fullPomoScore"),deleteCookie("partialPomoScore"),document.dispatchEvent(new CustomEvent("closeCurrentModal")),resetTimer(),resetPomoCounter(),removeTodos(),document.querySelector("#todo-create-button").classList.add("disabled"),document.querySelector("#account-popup-user-page").classList.add("hide"),document.querySelector("#account-popup-login-page").classList.remove("hide"),document.querySelector("#user-current-password-error").classList.contains("hide")||document.querySelector("#user-current-password-error").classList.add("hide"),document.querySelector("#user-confirm-password-error").classList.contains("hide")||document.querySelector("#user-confirm-password-error").classList.add("hide")})),document.querySelector("#information-modal-opener").addEventListener("click",(()=>{document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"information-popup",callback:()=>{const e=Flickity.data(document.querySelector(".main-carousel"));for(let t=0;t<50;t++)e.resize()}}}))}))}));const pomodoroCounterCircle=document.querySelector("#counter-circle"),pomodoroCounterRadius=pomodoroCounterCircle.r.baseVal.value,pomodoroCounterCircumference=2*pomodoroCounterRadius*Math.PI;function setPomoCounterProgress(e){pomodoroCounterCircle.style.strokeDashoffset=pomodoroCounterCircumference-e/100*pomodoroCounterCircumference}function resetTimer(){document.querySelector("#timer-text").textContent="25:00",PomoTimerInstance.resetTimer()}pomodoroCounterCircle.style.strokeDasharray=`${pomodoroCounterCircumference} ${pomodoroCounterCircumference}`,pomodoroCounterCircle.style.strokeDashoffset=`${pomodoroCounterCircumference}`;